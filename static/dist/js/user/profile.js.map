{"version":3,"names":[],"mappings":"","sources":["profile.js"],"sourcesContent":["import showNotification from './toast.js';\r\n\r\nconst username = document.getElementById('username')\r\nconst email = document.getElementById('email')\r\nconst currentPassword = document.getElementById('current-password')\r\nconst newPassword = document.getElementById('new-password')\r\nconst confirmPassword = document.getElementById('confirm-new-password')\r\nconst changeProfileBtn = document.getElementById('changeProfileBtn')\r\n\r\n// Завантажуємо дані користувача\r\nconst data_session = JSON.parse(sessionStorage.getItem('user'))\r\nconst data_local = JSON.parse(localStorage.getItem('user'))\r\nif (data_session) {\r\n    username.value = data_session.user.username\r\n    email.value = data_session.user.email\r\n} else if (data_local) {\r\n    username.value = data_local.user.username\r\n    email.value = data_local.user.email\r\n}\r\n\r\n// Обробка зміни паролю\r\nif (changeProfileBtn) {\r\n    changeProfileBtn.addEventListener('click', async (e) => {\r\n        e.preventDefault();\r\n        \r\n        // Перевіряємо, чи заповнені поля для зміни паролю\r\n        const hasPasswordFields = currentPassword.value || newPassword.value || confirmPassword.value;\r\n        \r\n        if (hasPasswordFields) {\r\n            // Валідація полів паролю\r\n            if (!currentPassword.value) {\r\n                showNotification('Enter current password', 'error');\r\n                return;\r\n            }\r\n            \r\n            if (!newPassword.value) {\r\n                showNotification('Enter new password', 'error');\r\n                return;\r\n            }\r\n            \r\n            if (newPassword.value.length < 6) {\r\n                showNotification('New password must be at least 6 characters long', 'error');\r\n                return;\r\n            }\r\n            \r\n            if (newPassword.value !== confirmPassword.value) {\r\n                showNotification('New passwords do not match', 'error');\r\n                return;\r\n            }\r\n            \r\n            // Відправляємо запит на зміну паролю\r\n            try {\r\n                changeProfileBtn.disabled = true;\r\n                changeProfileBtn.textContent = 'Saving...';\r\n                \r\n                const response = await fetch('/api/user/auth/change-password/', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                    },\r\n                    credentials: 'include', // Важливо для cookies з access_token\r\n                    body: JSON.stringify({\r\n                        current_password: currentPassword.value,\r\n                        new_password: newPassword.value,\r\n                        confirm_password: confirmPassword.value\r\n                    })\r\n                });\r\n                \r\n                const data = await response.json();\r\n                \r\n                if (!response.ok) {\r\n                    throw new Error(data.error || 'Error changing password');\r\n                }\r\n                \r\n                if (data.success) {\r\n                    showNotification('Password changed successfully!', 'success');\r\n                    \r\n                    // Очищаємо поля паролю\r\n                    currentPassword.value = '';\r\n                    newPassword.value = '';\r\n                    confirmPassword.value = '';\r\n                } else {\r\n                    throw new Error(data.error || 'Error changing password');\r\n                }\r\n                \r\n            } catch (error) {\r\n                console.error('Change password error:', error);\r\n                showNotification(error.message || 'Error changing password. Please try again.', 'error');\r\n            } finally {\r\n                changeProfileBtn.disabled = false;\r\n                changeProfileBtn.textContent = 'Save changes';\r\n            }\r\n        } else {\r\n            // Якщо поля паролю не заповнені, можна додати логіку для оновлення інших даних\r\n            showNotification('To change the password, fill in the password fields', 'info');\r\n        }\r\n    });\r\n}"],"file":"profile.js"}