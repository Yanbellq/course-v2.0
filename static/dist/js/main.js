let isLoading=!1,API_BASE_URL="/api";function showLoading(){var e=document.querySelector(".loading-overlay");e&&(e.classList.add("is-visible"),isLoading=!0)}function hideLoading(){var e=document.querySelector(".loading-overlay");e&&(e.classList.remove("is-visible"),isLoading=!1)}function formatCurrency(e,t="UAH"){return new Intl.NumberFormat("uk-UA",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:2}).format(e).replace("UAH","₴")}function formatDate(e){return new Date(e).toLocaleDateString("uk-UA",{year:"numeric",month:"long",day:"numeric"})}function formatShortDate(e){return new Date(e).toLocaleDateString("uk-UA",{year:"numeric",month:"2-digit",day:"2-digit"})}function debounce(a,o,n){let r;return function(...e){var t=n&&!r;clearTimeout(r),r=setTimeout(()=>{r=null,n||a(...e)},o),t&&a(...e)}}async function apiRequest(e,t={}){e=""+API_BASE_URL+e,t={...{headers:{"Content-Type":"application/json","X-CSRFToken":getCsrfToken()}},...t};try{showLoading();var a=await fetch(e,t);if(a.ok)return await a.json();throw new Error("HTTP error! status: "+a.status)}catch(e){throw console.error("API Request failed:",e),showNotification("Помилка завантаження даних","error"),e}finally{hideLoading()}}function getCsrfToken(){var e=document.querySelector("[name=csrfmiddlewaretoken]");return e?e.value:(e=document.cookie.split("; ").find(e=>e.startsWith("csrftoken=")))?e.split("=")[1]:""}function showNotification(e,t="info",a=5e3){let o=document.createElement("div");if(o.className="notification notification--"+t,o.innerHTML=`
        <div class="notification__content">
            <span class="notification__message">${e}</span>
            <button class="notification__close" onclick="this.parentElement.parentElement.remove()">×</button>
        </div>
    `,!document.querySelector(".notifications-container")){let e=document.createElement("div");e.className="notifications-container",e.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1080;
            pointer-events: none;
        `,document.body.appendChild(e)}let n=document.querySelector(".notifications-container");o.style.cssText=`
        background: var(--color-white);
        border: 1px solid var(--color-gray-200);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-lg);
        padding: var(--spacing-4);
        margin-bottom: var(--spacing-2);
        min-width: 300px;
        pointer-events: all;
        transform: translateX(100%);
        transition: transform 0.3s ease;
    `,"error"===t?(o.style.borderColor="var(--color-error)",o.style.backgroundColor="rgb(239 68 68 / 0.05)"):"success"===t?(o.style.borderColor="var(--color-success)",o.style.backgroundColor="rgb(16 185 129 / 0.05)"):"warning"===t&&(o.style.borderColor="var(--color-warning)",o.style.backgroundColor="rgb(245 158 11 / 0.05)"),n.appendChild(o),setTimeout(()=>{o.style.transform="translateX(0)"},100),0<a&&setTimeout(()=>{o.style.transform="translateX(100%)",setTimeout(()=>{o.parentElement&&o.remove()},300)},a)}function initHeader(){var e=document.querySelector(".search-toggle");let t=document.querySelector(".header__search");var a=document.querySelector(".mobile-menu-toggle");e&&t&&(e.addEventListener("click",()=>{if(t.classList.toggle("is-visible"),t.classList.contains("is-visible")){let e=t.querySelector(".search-form__input");e&&setTimeout(()=>e.focus(),300)}}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("is-visible")&&t.classList.remove("is-visible")})),a&&a.addEventListener("click",()=>{console.log("Mobile menu toggle")}),initSearch()}function initSearch(){var e=document.querySelector(".search-form");let a=document.querySelector(".search-form__input");var o=document.querySelector(".search-form__btn");if(e&&a){let t=debounce(performSearch,300);a.addEventListener("input",e=>{e=e.target.value.trim();2<=e.length&&t(e)}),o&&o.addEventListener("click",e=>{e.preventDefault();e=a.value.trim();e&&performSearch(e)}),e.addEventListener("submit",e=>{e.preventDefault();e=a.value.trim();e&&performSearch(e)})}}async function performSearch(e){try{console.log("Searching for:",e)}catch(e){console.error("Search failed:",e)}}function initDataTable(e,t={}){e=document.querySelector(e);e&&((t={sortable:!0,filterable:!0,pagination:!0,pageSize:10,...t}).sortable&&addTableSorting(e),t.filterable&&addTableFiltering(e),t.pagination)&&addTablePagination(e,t.pageSize)}function addTableSorting(e){return e}function sortTable(e,n,t){let a=e.querySelector("tbody");var o=Array.from(a.querySelectorAll("tr"));let r=t.classList.contains("sort-asc");e.querySelectorAll("th").forEach(e=>{e.classList.remove("sort-asc","sort-desc");e=e.querySelector(".sort-indicator");e&&(e.textContent="↕️")}),o.sort((e,t)=>{var e=e.cells[n].textContent.trim(),t=t.cells[n].textContent.trim(),a=parseFloat(e.replace(/[^\d.-]/g,"")),o=parseFloat(t.replace(/[^\d.-]/g,""));return isNaN(a)||isNaN(o)?r?t.localeCompare(e):e.localeCompare(t):r?o-a:a-o}),o.forEach(e=>a.appendChild(e)),t.classList.add(r?"sort-desc":"sort-asc");e=t.querySelector(".sort-indicator");e&&(e.textContent=r?"↓":"↑")}function addTableFiltering(a){var t=a.closest(".table-container");if(t&&!t.querySelector(".table-filter")){let e=document.createElement("input");e.type="text",e.placeholder="Фільтрувати...",e.className="table-filter form-input",e.style.marginBottom="var(--spacing-4)",e.id="table-filter",t.insertBefore(e,a);t=debounce(()=>{let t=e.value.toLowerCase();a.querySelector("tbody").querySelectorAll("tr").forEach(e=>{e.textContent.toLowerCase().includes(t)?e.style.display="":e.style.display="none"})},250);e.addEventListener("keyup",t)}}function addTablePagination(t,i){let l=t.closest(".table-container");if(l){t=t.querySelector("tbody");let e=Array.from(t.querySelectorAll("tr")),n=Math.ceil(e.length/i),r=1;function a(t){let a=((r=t)-1)*i,o=a+i;e.forEach((e,t)=>{e.style.display=t>=a&&t<o?"":"none"});{let e=l.querySelector(".pagination-container");e||((e=document.createElement("div")).className="pagination-container",e.style.marginTop="var(--spacing-4)",l.appendChild(e)),t='<div class="pagination">',t=(t=(t+=`<button class="btn btn--sm btn--secondary" ${1===r?"disabled":""} onclick="this.closest('.table-container').__pagination.showPage(${r-1})">Попередня</button>`)+`<span class="pagination__info">Сторінка ${r} з ${n}</span>`)+`<button class="btn btn--sm btn--secondary" ${r===n?"disabled":""} onclick="this.closest('.table-container').__pagination.showPage(${r+1})">Наступна</button>`+"</div>",e.innerHTML=t}}n<=1||(l.__pagination={showPage:a},a(1))}}function initForms(){document.querySelectorAll('form[data-ajax="true"]').forEach(e=>{e.addEventListener("submit",handleFormSubmit)}),document.querySelectorAll(".form-input, .form-select, .form-textarea").forEach(e=>{e.addEventListener("blur",validateField),e.addEventListener("input",clearFieldError)})}async function handleFormSubmit(t){t.preventDefault();var t=t.target,e=t.querySelector('button[type="submit"]'),a=e?e.textContent:"";try{e&&(e.disabled=!0,e.textContent="Збереження...");var o=new FormData(t),n=Object.fromEntries(o.entries()),r=(n.email&&(n.email+="@gmail.com"),t.getAttribute("action")||window.location.pathname),i=await apiRequest(r,{method:t.method||"POST",body:JSON.stringify(n)});showNotification("Дані успішно збережено","success"),i.redirect_url?window.location.href=i.redirect_url:"true"===t.dataset.reload&&window.location.reload()}catch(e){showNotification("Помилка збереження даних","error"),e.field_errors&&displayFieldErrors(t,e.field_errors)}finally{e&&(e.disabled=!1,e.textContent=a)}}function validateField(e){var e=e.target,t=e.value.trim();e.name;clearFieldError({target:e});let a=null;e.hasAttribute("required")&&!t?a="Це поле обов'язкове":"tel"===e.type&&t&&!isValidPhone(t)?a="Невірний формат телефону":e.dataset.minLength&&t.length<parseInt(e.dataset.minLength)&&(a=`Мінімальна довжина ${e.dataset.minLength} символів`),a&&(showError(e,a),displayFieldError(e,a))}function clearFieldError(e){var e=e.target,t=e.parentElement.querySelector(".form-error");t&&t.remove(),e.classList.remove("form-input--error")}function displayFieldError(e,t){clearFieldError({target:e}),e.classList.add("form-input--error");var a=document.createElement("div");a.className="form-error",a.textContent=t,e.parentElement.appendChild(a)}function displayFieldErrors(a,o){Object.keys(o).forEach(e=>{var t=a.querySelector(`[name="${e}"]`);t&&displayFieldError(t,o[e][0])})}function showError(e,t){e=e.closest(".input-group");let a=e.nextElementSibling;a&&a.classList.contains("error-message")||((a=document.createElement("div")).className="error-message text-error mt-1 text-sm",e.insertAdjacentElement("afterend",a)),a.textContent=t}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function isValidPhone(e){return/^\+380\d{9}$/.test(e.replace(/[\s\-\(\)]/g,""))}function openModal(t){t=document.getElementById(t);if(t){t.classList.add("is-visible"),document.body.style.overflow="hidden";let e=t.querySelector("input, button, textarea, select");e&&setTimeout(()=>e.focus(),100)}}function closeModal(e){e=document.getElementById(e);e&&(e.classList.remove("is-visible"),document.body.style.overflow="")}function initModals(){document.addEventListener("click",e=>{e.target.classList.contains("modal")&&closeModal(e.target.id)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(e=document.querySelector(".modal.is-visible"))&&closeModal(e.id)}),document.addEventListener("click",e=>{e.target.classList.contains("modal-close")&&(e=e.target.closest(".modal"))&&closeModal(e.id)})}async function loadData(e,t,a){t=document.getElementById(t);if(t)try{showLoading(),a(await apiRequest(e),t)}catch(e){t.innerHTML='<p class="text-error">Помилка завантаження даних</p>'}finally{hideLoading()}}function initPagination(e,a){let t=document.getElementById(e);if(t){let t=1;window.loadPage=function(e){e<1||(t=e,a(e,10))}}}function handleGlobalClicks(e){var t=e.target;console.log("object hui"),t.dataset.action&&(e.preventDefault(),handleDataAction(t.dataset.action,t)),t.classList.contains("confirm-link")&&(e.preventDefault(),e=t.dataset.confirm||"Ви впевнені?",confirm(e))&&(window.location.href=t.href)}function handleDataAction(e,t){switch(e){case"delete":handleDelete(t);break;case"toggle-status":handleToggleStatus(t);break;case"export":handleExport(t);break;default:console.warn("Unknown action:",e)}}async function handleDelete(e){var t=e.dataset.confirm||"Ви впевнені, що хочете видалити?";if(confirm(t)){t=e.dataset.url||e.href;try{await apiRequest(t,{method:"DELETE"}),showNotification("Запис видалено","success");var a=e.closest("tr");a?a.remove():window.location.reload()}catch(e){showNotification("Помилка видалення","error")}}}async function handleToggleStatus(e){var t=e.dataset.url,a=e.dataset.status;try{var o=await apiRequest(t,{method:"POST",body:JSON.stringify({status:"active"===a?"inactive":"active"})});e.dataset.status=o.status,e.textContent="active"===o.status?"Деактивувати":"Активувати",showNotification("Статус оновлено","success")}catch(e){showNotification("Помилка оновлення статусу","error")}}function handleExport(e){var t=e.dataset.url,e=e.dataset.format||"excel";window.open(t+"?format="+e,"_blank")}document.addEventListener("DOMContentLoaded",function(){initHeader(),initForms(),initModals(),0<document.querySelectorAll(".table-container .table-wrapper").length&&initDataTable(".table-container .table-wrapper"),document.addEventListener("click",handleGlobalClicks),console.log("PC Management System initialized")}),window.PCManagement={apiRequest:apiRequest,showNotification:showNotification,showLoading:showLoading,hideLoading:hideLoading,formatCurrency:formatCurrency,formatDate:formatDate,formatShortDate:formatShortDate,debounce:debounce,openModal:openModal,closeModal:closeModal,validateField:validateField,clearFieldError:clearFieldError,displayFieldError:displayFieldError,loadData:loadData,initDataTable:initDataTable,initPagination:initPagination};